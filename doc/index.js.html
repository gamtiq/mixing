<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: index.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * @module mixing 
 */

// Load shim only in browser environment. Array.isArray is defined in node
if (! Array.isArray) {
    require("isarray-shim");
}

/**
 * Copy/add all fields and functions from source objects into the target object.
 * As a result the target object may be modified.
 *
 * @param {Object} destination
 *      The target object into which fields and functions will be copied.
 * @param {Array | Object} source
 *      Array of source objects or just one object whose contents will be copied.
 *      If a source is a falsy value (e.g. &lt;code>null&lt;/code> or &lt;code>undefined&lt;/code>), the source will be skipped.
 * @param {Object} [settings]
 *      Operation settings. Fields are names of settings, their values are the corresponding values of settings.
 *      The following settings are being supported.
 *      &lt;table>
 *          &lt;tr>
 *              &lt;th>Name&lt;/th>&lt;th>Type&lt;/th>&lt;th>Default value&lt;/th>&lt;th>Description&lt;/th>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>copyFunc&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>true&lt;/code>&lt;/td>
 *              &lt;td>Should functions be copied?&lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>funcToProto&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Should functions be copied into &lt;code>prototype&lt;/code> of the target object's &lt;code>constructor&lt;/code>
 *                  (i.e. into &lt;code>destination.constructor.prototype&lt;/code>)?
 *                  &lt;br>
 *                  If &lt;code>false&lt;/code> then functions will be copied directly into the target object.
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>overwrite&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>Should a field/function be overwritten when it exists in the target object?&lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>recursive&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Should this function be called recursively when field's value of the target and source object is an object?
 *                  &lt;br>
 *                  If &lt;code>true&lt;/code> then object fields from the target and source objects will be mixed by using this function
 *                  with the same settings.
 *                  &lt;br>
 *                  This option has no dependency with &lt;code>overwrite&lt;/code> setting and has priority over it.
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>mixFromArray&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Should contents of a field of the source object be copied when the field's value is an array?
 *                  &lt;br>
 *                  Will be used only when &lt;code>recursive&lt;/code> setting has &lt;code>true&lt;/code> value.
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>mixToArray&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Should contents of a field of the source object be copied into a field of the target object
 *                  when the latest field's value is an array?
 *                  &lt;br>
 *                  Will be used only when &lt;code>recursive&lt;/code> setting has &lt;code>true&lt;/code> value.
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>oneSource&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Indicates that array that is passed as &lt;code>source&lt;/code> parameter should be interpreted
 *                  directly as copied object instead of list of source objects.
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>ownProperty&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Boolean&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>false&lt;/code>&lt;/td>
 *              &lt;td>Should only own properties of the source object be copied in the target object?&lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>except&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Array | Object | String&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>""&lt;/code> (empty string)&lt;/td>
 *              &lt;td>
 *                  Array, object (the preferred variant) or string that defines names of fields/functions that shouldn't be copied.
 *                  &lt;br>
 *                  If an object is passed then his fields determine non-copied elements.
 *                  If a string is passed then it is name of the only non-copied field.
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>filter&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Function&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>null&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Allows selecting elements that should be copied.
 *                  &lt;br>
 *                  If specified function returns &lt;code>true&lt;/code> for a field,
 *                  the field will be copied in the target object.
 *                  &lt;br>
 *                  The following parameters are passed into filter function:
 *                  &lt;ul>
 *                  &lt;li>field name
 *                  &lt;li>field value
 *                  &lt;li>reference to the target object
 *                  &lt;li>reference to the source object
 *                  &lt;/ul>
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>otherName&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Object&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>null&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Defines "renaming table" for copied elements.
 *                  &lt;br>
 *                  Fields of the table are names from a source object, values are the corresponding names in the target object.
 *                  &lt;br>
 *                  For example, the call
 *                  &lt;br>
 *                  &lt;code>
 *                  mixing({}, {field: 1, func: "no-func"}, {otherName: {"field": "prop", "func": "method"}})
 *                  &lt;/code>
 *                  &lt;br>
 *                  will return the following object
 *                  &lt;br>
 *                  &lt;code>{prop: 1, method: "no-func"}&lt;/code>
 *              &lt;/td>
 *          &lt;/tr>
 *          &lt;tr>
 *              &lt;td>&lt;code>change&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>Function&lt;/code>&lt;/td>
 *              &lt;td>&lt;code>null&lt;/code>&lt;/td>
 *              &lt;td>
 *                  Gives ability to change values that should be copied.
 *                  &lt;br>
 *                  Value returned by the function for a field will be copied into the target object 
 *                  instead of original field's value.
 *                  &lt;br>
 *                  The following parameters are passed into change function:
 *                  &lt;ul>
 *                  &lt;li>field name
 *                  &lt;li>original field value
 *                  &lt;li>reference to the target object
 *                  &lt;li>reference to the source object
 *                  &lt;/ul>
 *              &lt;/td>
 *          &lt;/tr>
 *      &lt;/table>
 *      &lt;code>except&lt;/code> and &lt;code>filter&lt;/code> settings can be used together.
 *      In such situation a field will be copied only when the field satisfies both settings
 *      (i.e. not in exceptions and filter function returns &lt;code>true&lt;/code>).
 * @return {Object}
 *      Modified target object.
 * @alias module:mixing
 */
function mixing(destination, source, settings) {
    /*jshint boss:true, laxbreak:true*/
    if (typeof source === "object" && source !== null) {
        // Prepare parameters
        if (typeof settings !== "object" || settings === null) {
            settings = {};
        }
        if (! Array.isArray(source) || settings.oneSource) {
            source = [source];
        }
        // Prepare settings
        var bCopyFunc = ("copyFunc" in settings ? settings.copyFunc : true),
            bFuncToProto = Boolean(settings.funcToProto),
            bMixFromArray = Boolean(settings.mixFromArray),
            bMixToArray = Boolean(settings.mixToArray),
            bOverwrite = Boolean(settings.overwrite),
            bOwnProperty = Boolean(settings.ownProperty),
            bRecursive = Boolean(settings.recursive),
            change = settings.change,
            filter = settings.filter,
            otherNameMap = ("otherName" in settings ? settings.otherName : null),
            exceptList = settings.except,
            bFuncProp, exceptions, nI, nL, obj, propName, propValue, sType, value;
        if (exceptList) {
            if (Array.isArray(exceptList)) {
                if (exceptList.length > 0) {
                    exceptions = {};
                    nI = exceptList.length;
                    do {
                        exceptions[ exceptList[--nI] ] = null;
                    } while(nI);
                }
            }
            else {
                sType = typeof exceptList;
                if (sType === "string") {
                    exceptions = {};
                    exceptions[exceptList] = null;
                }
                else if (sType === "object") {
                    exceptions = exceptList;
                }
            }
        }
        
        // Copy fields and functions according to settings
        for (nI = 0, nL = source.length; nI &lt; nL; nI++) {
            if (obj = source[nI]) {
                for (propName in obj) {
                    propValue = obj[propName];
                    if ((! bOwnProperty || obj.hasOwnProperty(propName)) 
                            && (! exceptions || ! (propName in exceptions)) 
                            && (! filter || filter(propName, propValue, destination, obj))) {
                        if (otherNameMap && (propName in otherNameMap)) {
                            propName = otherNameMap[propName];
                        }
                        sType = typeof propValue;
                        // If recursive mode and field's value is an object
                        if (bRecursive && propValue && sType === "object" && (value = destination[propName]) && typeof value === "object"
                                && (! Array.isArray(propValue) || bMixFromArray) && (! Array.isArray(value) || bMixToArray)) {
                            mixing(value, propValue, 
                                    bMixFromArray 
                                        ? mixing({oneSource: true}, settings)
                                        : settings);
                        }
                        else {
                            bFuncProp = (sType === "function");
                            if ((bOverwrite || ! (propName in destination))
                                    && (! bFuncProp || bCopyFunc)) {
                                if (change) {
                                    propValue = change(propName, propValue, destination, obj);
                                }
                                if (bFuncProp && bFuncToProto) {
                                    destination.constructor.prototype[propName] = propValue;
                                }
                                else {
                                    destination[propName] = propValue;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
    return destination;
}

/**
 * Make a copy of source object(s).
 * &lt;br>
 * This function is a "wrap" for the following code:
 * &lt;code>&lt;pre>
 * var copy = mixing({}, source, settings);
 * &lt;/pre>&lt;/code>
 * 
 * @param {Array | Object} source
 *      Array of source objects or just one object whose contents will be copied.
 * @param {Object} [settings]
 *      Operation settings. See {@link module:mixing mixing} for details.
 * @return {Object}
 *      Newly created object containing contents of source objects.
 */
mixing.copy = function(source, settings) {
    return mixing({}, source, settings);
};

/**
 * Make a copy of &lt;code>this&lt;/code> object.
 * &lt;br>
 * This function is a "wrap" for the following code:
 * &lt;code>&lt;pre>
 * var copy = mixing({}, this, settings);
 * &lt;/pre>&lt;/code>
 * It can be transferred to an object to use as a method.
 * 
 * @param {Object} [settings]
 *      Operation settings. See {@link module:mixing mixing} for details.
 * @return {Object}
 *      Newly created object containing contents of &lt;code>this&lt;/code> object.
 */
mixing.clone = function(settings) {
    return mixing({}, this, settings);
};

/**
 * Filter &lt;code>this&lt;/code> object.
 * &lt;br>
 * This function is a "wrap" for the following code:
 * &lt;code>&lt;pre>
 * var result = mixing({}, this, {filter: filter});
 * &lt;/pre>&lt;/code>
 * It can be transferred to an object to use as a method.
 * 
 * @param {Function | Object} filter
 *      Filter function to select fields or object that represents operation settings including filter function.
 *      See {@link module:mixing mixing} for details.
 * @return {Object}
 *      Newly created object containing fields of &lt;code>this&lt;/code> object for which filter function returns true.
 */
mixing.filter = function(filter) {
    return mixing({}, this, typeof filter === "function" ? {filter: filter} : filter);
};

/**
 * Copy and change values of fields of &lt;code>this&lt;/code> object.
 * &lt;br>
 * This function is a "wrap" for the following code:
 * &lt;code>&lt;pre>
 * var result = mixing({}, this, {change: change});
 * &lt;/pre>&lt;/code>
 * It can be transferred to an object to use as a method.
 * 
 * @param {Function | Object} change
 *      Function to change values of copied fields or object that represents operation settings including change function.
 *      See {@link module:mixing mixing} for details.
 * @return {Object}
 *      Newly created object containing fields of &lt;code>this&lt;/code> object with changed values.
 */
mixing.map = function(change) {
    return mixing({}, this, typeof change === "function" ? {change: change} : change);
};

/**
 * Copy/add all fields and functions from source objects into &lt;code>this&lt;/code> object.
 * As a result &lt;code>this&lt;/code> object may be modified.
 * &lt;br>
 * This function is a "wrap" for the following code:
 * &lt;code>&lt;pre>
 * mixing(this, source, settings);
 * &lt;/pre>&lt;/code>
 * It can be transferred to an object to use as a method.
 * 
 * @param {Array | Object} source
 *      Array of source objects or just one object whose contents will be copied.
 * @param {Object} [settings]
 *      Operation settings. See {@link module:mixing mixing} for details.
 * @return {Object}
 *      Modified &lt;code>this&lt;/code> object.
 */
mixing.mix = function(source, settings) {
    return mixing(this, source, settings);
};

module.exports = mixing;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-mixing.html">mixing</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Sat Jul 05 2014 20:44:05 GMT+0400 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
